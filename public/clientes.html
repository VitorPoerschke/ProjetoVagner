<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Clientes - Vagner Poerschke</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* ... [estilo anterior permanece o mesmo] ... */
     * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      background: linear-gradient(to right, #1e1e2f, #2e2e48);
      color: white;
      display: flex;
      min-height: 100vh;
    }

    aside {
      width: 250px;
      background: #1c1c2e;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .logo {
      font-size: 18px;
      color: #facc15;
      margin-bottom: 30px;
    }

    nav a {
      display: block;
      color: #ccc;
      margin: 10px 0;
      text-decoration: none;
      padding: 8px;
      border-radius: 6px;
      transition: 0.3s;
    }

    nav a:hover {
      background-color: #2c2c44;
      color: #fff;
    }

    .btn-voltar {
      background-color: #ef4444;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
    }

    .btn-voltar:hover {
      background-color: #dc2626;
    }

    main {
      flex: 1;
      padding: 30px;
      overflow-x: auto;
      animation: fadeIn 0.6s ease-in-out;
    }

    h2 {
      margin-bottom: 20px;
      color: #facc15;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #2a2a3d;
      border-radius: 10px;
      overflow: hidden;
      animation: slideUp 0.8s ease-in-out;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #444;
    }

    th {
      background-color: #1e1e2e;
      color: #facc15;
    }

    tr:hover {
      background-color: #33334d;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .topo-clientes {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .topo-clientes input {
      padding: 8px;
      border-radius: 6px;
      border: none;
      width: 250px;
      background-color: #1a1a2d;
      color: white;
      margin-bottom: 10px;
    }

    .topo-clientes button {
      padding: 8px 16px;
      border-radius: 6px;
      background-color: #4f46e5;
      color: white;
      border: none;
      cursor: pointer;
      transition: 0.3s;
      margin-left: 10px;
    }

    .topo-clientes button:hover {
      background-color: #6366f1;
    }

    .detalhes-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #1e1e2f;
      color: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 25px rgba(0,0,0,0.6);
      z-index: 1000;
      display: none;
      max-width: 400px;
    }

    .detalhes-modal h3 {
      color: #facc15;
      margin-bottom: 15px;
    }

    .detalhes-modal p {
      margin: 8px 0;
      font-size: 14px;
    }

    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      z-index: 999;
    }
  </style>
</head>
<body>

  <aside>
    <div>
      <div class="logo">‚öñÔ∏è Vagner Poerschke üèõÔ∏è Advocacia</div>
      <nav>
        <a href="painel.html">üìä Painel</a>
        <a href="listarTarefas.html">üóÇÔ∏è Tarefas</a>
        <a href="revisarRespostas.html">üì© Revisar Respostas</a>
        <a href="clientes.html">üë• Clientes</a>
      </nav>
    </div>
    <button class="btn-voltar" onclick="logout()">Voltar</button>
  </aside>

  <main>
    <h2>Lista de Clientes</h2>

    <div class="topo-clientes">
      <input type="text" id="filtro" placeholder="Buscar por nome, CPF, email..." oninput="filtrarClientes()">
      <button onclick="exportarCSV()">‚¨áÔ∏è Exportar CSV</button>
    </div>

    <table id="tabelaClientes">
      <thead>
        <tr>
          <th>Nome</th>
          <th>CPF/CNPJ</th>
          <th>Email</th>
          <th>Processos</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <div class="overlay" id="overlay" onclick="fecharModal()"></div>
  <div class="detalhes-modal" id="modalDetalhes"></div>

  <script>
    let clientes = [];

    async function carregarClientes() {
      const token = localStorage.getItem('token');
      if (!token) return window.location.href = 'index.html';

      try {
        const res = await fetch('/api/clientes', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        clientes = await res.json();
        renderizarTabela(clientes);
      } catch (err) {
        console.error('Erro ao carregar clientes:', err);
        alert('Erro ao buscar clientes.');
      }
    }

    function renderizarTabela(lista) {
      const tbody = document.querySelector('#tabelaClientes tbody');
      tbody.innerHTML = '';
      lista.forEach(c => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${c.nome}</td>
          <td>${c.cpfCnpj}</td>
          <td>${c.email}</td>
          <td>${c.processosVinculados || 0}</td>
          <td><button onclick='mostrarDetalhes(${JSON.stringify(c)})'>Ver Detalhes</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    function filtrarClientes() {
      const texto = document.getElementById('filtro').value.toLowerCase();
      const filtrados = clientes.filter(c =>
        c.nome.toLowerCase().includes(texto) ||
        c.cpfCnpj.toLowerCase().includes(texto) ||
        c.email.toLowerCase().includes(texto)
      );
      renderizarTabela(filtrados);
    }

    function exportarCSV() {
      const linhas = [['Nome', 'CPF/CNPJ', 'Endere√ßo', 'Telefone 1', 'Telefone 2', 'Email', 'PIS/PASEP', 'Processos']];
      clientes.forEach(c => {
        linhas.push([c.nome, c.cpfCnpj, c.endereco, c.telefone1, c.telefone2 || '', c.email, c.pisPasep || '', c.processosVinculados || 0]);
      });

      const csv = linhas.map(l => l.join(';')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = 'clientes.csv';
      a.click();
      URL.revokeObjectURL(url);
    }

    function mostrarDetalhes(cliente) {
      const modal = document.getElementById('modalDetalhes');
      const overlay = document.getElementById('overlay');
      modal.innerHTML = `
        <h3>Detalhes de ${cliente.nome}</h3>
        <p><strong>CPF/CNPJ:</strong> ${cliente.cpfCnpj}</p>
        <p><strong>Endere√ßo:</strong> ${cliente.endereco}</p>
        <p><strong>Telefone 1:</strong> ${cliente.telefone1}</p>
        <p><strong>Telefone 2:</strong> ${cliente.telefone2 || '-'}</p>
        <p><strong>Email:</strong> ${cliente.email}</p>
        <p><strong>PIS/PASEP:</strong> ${cliente.pisPasep || '-'}</p>
        <p><strong>Processos Vinculados:</strong> ${cliente.processosVinculados || 0}</p>
        <br>
        <button onclick="fecharModal()">Fechar</button>
      `;
      modal.style.display = 'block';
      overlay.style.display = 'block';
    }

    function fecharModal() {
      document.getElementById('modalDetalhes').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }

    function logout() {
      localStorage.removeItem('token');
      window.location.href = 'index.html';
    }

    carregarClientes();
  </script>

</body>
</html>
